import{_ as e,r as l,e as a,f as o,g as t,m as r,i as n,j as s,c as d,k as i,L as u,b as m,v as p,M as c,h as b,l as f,x as h,q as _}from"./index-96f101f2.js";import{u as g,a as w}from"./useCommon-ceabe716.js";import{w as V}from"./web3Util-806d81ef.js";import"./web3.min-4221e9b3.js";const v={class:"image-slot"},y={class:"dialog-footer"},k=m("取消"),C=m("提交"),U=e({__name:"UserInfoEditForm",emits:["selectPageReq","hideComp"],setup(e,{expose:m,emit:c}){let b=l({name:"",brand:"",brandIcon:"",password:""});const f=a(null);let h=()=>{f.value.validate((e=>{if(!e)return!1;U()}))};const{formRules:_,elMessage:V}=g();let U=()=>{const e=JSON.parse(JSON.stringify(b));return e.rePassword=e.password,p({url:"/api/mall3/user/set/info",data:e,method:"put",bfLoading:!0}).then((e=>{V("更新用户信息成功"),c("selectPageReq"),c("hideComp")}))};const{dialogTitle:j,dialogVisible:I}=w();let x=()=>{c("hideComp")};return m({showModal:e=>{var l;j.value="更新用户信息",I.value=!0,l=e,Object.keys(l).forEach((e=>{Object.keys(b).forEach((a=>{e===a&&(b[a]=l[a])}))}))}}),(e,l)=>{const a=o("el-input"),m=o("el-form-item"),p=o("icon-picture"),c=o("el-icon"),g=o("el-image"),w=o("el-form"),V=o("el-button"),U=o("el-dialog");return t(),r(U,{modelValue:i(I),"onUpdate:modelValue":l[4]||(l[4]=e=>u(I)?I.value=e:null),title:i(j),width:"50vw","close-on-click-modal":!1,"before-close":i(x)},{footer:n((()=>[s("span",y,[d(V,{onClick:i(x)},{default:n((()=>[k])),_:1},8,["onClick"]),d(V,{type:"primary",onClick:i(h)},{default:n((()=>[C])),_:1},8,["onClick"])])])),default:n((()=>[d(w,{ref_key:"refForm",ref:f,"label-width":"200px",inline:!1,model:i(b),rules:i(_),class:"pr-5"},{default:n((()=>[d(m,{label:"用户名",prop:"name","label-position":"left"},{default:n((()=>[d(a,{modelValue:i(b).name,"onUpdate:modelValue":l[0]||(l[0]=e=>i(b).name=e)},null,8,["modelValue"])])),_:1}),d(m,{label:"品牌",prop:"brand","label-position":"left"},{default:n((()=>[d(a,{modelValue:i(b).brand,"onUpdate:modelValue":l[1]||(l[1]=e=>i(b).brand=e)},null,8,["modelValue"])])),_:1}),d(m,{label:"品牌图标",prop:"brandIcon","label-position":"left"},{default:n((()=>[d(a,{modelValue:i(b).brandIcon,"onUpdate:modelValue":l[2]||(l[2]=e=>i(b).brandIcon=e)},null,8,["modelValue"]),d(g,{style:{width:"60px",height:"60px"},src:i(b).brandIcon,fit:"fill"},{error:n((()=>[s("div",v,[d(c,null,{default:n((()=>[d(p)])),_:1})])])),_:1},8,["src"])])),_:1}),d(m,{label:"密码",prop:"password","label-position":"left"},{default:n((()=>[d(a,{modelValue:i(b).password,"onUpdate:modelValue":l[3]||(l[3]=e=>i(b).password=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","before-close"])}}},[["__file","/Users/liuzhaoming/百度云同步盘/mac同步/project/valor/web3/mall/mall3-web/src/views/account/user/UserInfoEditForm.vue"]]),j={class:"scroll-y",width:"50vw"},I={class:"image-slot"},x=m("修改用户信息"),W=m("绑定Web3钱包"),A={name:"UserMng"},E=e(Object.assign(A,{setup(e){const{elMessage:u}=g();let m=l({name:"",brand:"",brandIcon:"",pubWeb3Addr:""});c((()=>{w()}));let w=()=>{p({url:"/api/mall3/auth/me",method:"get"}).then((e=>{Object.keys(e.data).forEach((l=>{Object.keys(m).forEach((a=>{l===a&&(m[a]=e.data[a])}))}))}))},v=a(!1);const y=a(null),k=()=>{v.value=!1};let C=()=>{v.value=!0,h((()=>{y.value.showModal(m)}))},A=()=>{_(),m.pubWeb3Addr?u("用户已经绑定Web3钱包, 不可以重复绑定","error"):V.getWeb3().then((e=>{let l=e;l.eth.getCoinbase().then((e=>{const a=e.toLowerCase();let o={url:"/api/mall3/auth/nonce",method:"get",data:{pubAddress:a},isParams:!0};p(o).then((e=>{let t=e.data;t?l.eth.personal.sign(t,a,"").then((e=>{o={url:"/api/mall3/user/set/web3",method:"put",data:{pubAddress:a,signature:e}},p(o).then((e=>{w()})).catch((e=>{}))})):u("无法生成随机字符串","error")}))}))}))};return(e,l)=>{const a=o("el-input"),u=o("el-form-item"),p=o("icon-picture"),c=o("el-icon"),h=o("el-image"),_=o("el-button"),g=o("el-form");return t(),b("div",j,[d(g,{"label-width":"200px",inline:!1,model:i(m),class:"pr-5"},{default:n((()=>[d(u,{label:"用户名",prop:"name","label-position":"left"},{default:n((()=>[d(a,{modelValue:i(m).name,"onUpdate:modelValue":l[0]||(l[0]=e=>i(m).name=e),readonly:""},null,8,["modelValue"])])),_:1}),d(u,{label:"品牌",prop:"brand","label-position":"left"},{default:n((()=>[d(a,{modelValue:i(m).brand,"onUpdate:modelValue":l[1]||(l[1]=e=>i(m).brand=e),readonly:""},null,8,["modelValue"])])),_:1}),d(u,{label:"品牌图标",prop:"brandIcon","label-position":"left"},{default:n((()=>[d(h,{style:{width:"100px",height:"100px"},src:i(m).brandIcon,fit:"fill"},{error:n((()=>[s("div",I,[d(c,null,{default:n((()=>[d(p)])),_:1})])])),_:1},8,["src"])])),_:1}),d(u,{label:"Web3钱包地址",prop:"pubWeb3Addr","label-position":"left"},{default:n((()=>[d(a,{modelValue:i(m).pubWeb3Addr,"onUpdate:modelValue":l[2]||(l[2]=e=>i(m).pubWeb3Addr=e),readonly:""},null,8,["modelValue"])])),_:1}),d(u,null,{default:n((()=>[d(_,{type:"primary",onClick:i(C)},{default:n((()=>[x])),_:1},8,["onClick"]),d(_,{type:"warning",onClick:i(A)},{default:n((()=>[W])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),i(v)?(t(),r(U,{key:0,ref_key:"refEditForm",ref:y,onHideComp:k,onSelectPageReq:i(w)},null,8,["onSelectPageReq"])):f("v-if",!0)])}}}),[["__scopeId","data-v-03b8b123"],["__file","/Users/liuzhaoming/百度云同步盘/mac同步/project/valor/web3/mall/mall3-web/src/views/account/user/User.vue"]]);export{E as default};
