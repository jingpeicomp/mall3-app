import{_ as e,r as l,w as a,e as t,f as o,g as n,m as r,i,j as s,c as u,k as d,L as m,b as c,v as p,M as h,h as f,t as b,l as g,P as v,N as A,O as y,x as _,y as w,z as C}from"./index-68f4f231.js";import{w as P}from"./web3Util-db437a6e.js";import"./web3.min-f7ec714c.js";import{u as V,a as k}from"./useCommon-97a7458f.js";import{t as x}from"./useTablePage-337a13be.js";const j={class:"dialog-footer"},z=c("取消"),R=c("提交"),E=e({__name:"VcoinRechargeForm",emits:["selectPageReq","hideComp"],setup(e,{expose:c,emit:h}){let f=l({fromPubAddress:"",toPubAddress:"0XE5A70661C17AC8B012CB9A822EBAB93A27C19859",vcoinAmount:1e4,ethAmount:1e-4,txId:"",id:null});a((()=>f.vcoinAmount),(e=>{f.ethAmount=e/1e8}));const b=t(null);let g=()=>{b.value.validate((e=>{if(!e)return!1;y()}))};const{formRules:v,elMessage:A}=V();let y=()=>p({url:"/api/mall3/vcoin/recharge",data:f,method:"post",bfLoading:!0}).then((e=>{let l=null==e?void 0:e.data;f.id=l.id,f.toPubAddress=l.ethPubAddr,f.ethAmount=l.payAmount,P.getWeb3().then((e=>{let l=e;l.eth.getTransactionCount(f.fromPubAddress).then((e=>{let a={from:f.fromPubAddress,to:f.toPubAddress,value:l.utils.toWei(""+f.ethAmount,"ether"),nonce:e};l.eth.sendTransaction(a,((e,l)=>{let a="";e?(a="ERROR:"+e,A("Web3转账交易失败: "+e,"error")):(a=l,f.txId=l,_())}))}))}))})),_=()=>p({url:"/api/mall3/vcoin/recharge/pay",data:f,method:"put",bfLoading:!0}).then((()=>{A("Vcoin充值单支付信息提交成功, 稍后刷新页面!"),h("selectPageReq"),h("hideComp")}));const{dialogTitle:w,dialogVisible:C}=k();let x=()=>{h("hideComp")};return c({showModal:e=>{var l;w.value="Web3虚拟货币充值Vcoin",C.value=!0,l=e,Object.keys(l).forEach((e=>{Object.keys(f).forEach((a=>{e===a&&(f[a]=l[a])}))}))}}),(e,l)=>{const a=o("el-input-number"),t=o("el-form-item"),c=o("el-input"),p=o("el-form"),h=o("el-button"),A=o("el-dialog");return n(),r(A,{modelValue:d(C),"onUpdate:modelValue":l[3]||(l[3]=e=>m(C)?C.value=e:null),title:d(w),width:"50vw","close-on-click-modal":!1,"before-close":d(x)},{footer:i((()=>[s("span",j,[u(h,{onClick:d(x)},{default:i((()=>[z])),_:1},8,["onClick"]),u(h,{type:"primary",onClick:d(g)},{default:i((()=>[R])),_:1},8,["onClick"])])])),default:i((()=>[u(p,{ref_key:"refForm",ref:b,"label-width":"200px",inline:!1,model:d(f),rules:d(v),class:"pr-5"},{default:i((()=>[u(t,{label:"Vcoin数目(10000倍数)",prop:"vcoinAmount","label-position":"left",rules:d(v).isNotNull},{default:i((()=>[u(a,{modelValue:d(f).vcoinAmount,"onUpdate:modelValue":l[0]||(l[0]=e=>d(f).vcoinAmount=e),step:1e4,"step-strictly":""},null,8,["modelValue"])])),_:1},8,["rules"]),u(t,{label:"需要支付的以太币",prop:"ethAmount","label-position":"left"},{default:i((()=>[u(c,{modelValue:d(f).ethAmount,"onUpdate:modelValue":l[1]||(l[1]=e=>d(f).ethAmount=e),readonly:""},null,8,["modelValue"])])),_:1}),u(t,{label:"付款Web3钱包地址",prop:"fromPubAddress","label-position":"left"},{default:i((()=>[u(c,{modelValue:d(f).fromPubAddress,"onUpdate:modelValue":l[2]||(l[2]=e=>d(f).fromPubAddress=e),readonly:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","before-close"])}}},[["__file","/Users/liuzhaoming/百度云同步盘/mac同步/project/valor/web3/mall/mall3-web/src/views/account/vcoin/VcoinRechargeForm.vue"]]),S={class:"mr-3 rowSS top-div"},U={class:"amount-balance"},I=(e=>(w("data-v-690ffb5a"),e=e(),C(),e))((()=>s("span",{style:{"vertical-align":"middle"}},"充值",-1))),T=c("刷新"),W={class:"scroll-y"},F={class:"block columnCC mt-2"},M={name:"UserMng"},N=e(Object.assign(M,{setup(e){let a=t([]),m=l({state:0}),w=[{value:0,display:"全部"},{value:1,display:"待支付"},{value:2,display:"已支付"},{value:3,display:"支付失败"}];h((()=>{z()}));let C=e=>2==e?"支付成功":3==e?"支付失败":"待支付";const V=()=>{R.value=1,z()};let k=t(1),j=t(1),z=()=>{const e={pageNumber:R.value-1,pageSize:M.value};0!=m.state&&(e.state=m.state),p({url:"/api/mall3/account/me",method:"get"}).then((e=>{var l;j.value=null==(l=e.data)?void 0:l.balanceAmount})),p({url:"/api/mall3/vcoin/recharge",method:"get",data:e,isParams:!0}).then((e=>{var l;a.value=e.data.content;for(const a of e.data.content)a.actualPayAmount=(a.paidAmount||0)+(a.gasAmount||0);k.value=null==(l=e.data)?void 0:l.total}))},{pageNum:R,pageSize:M,handleCurrentChange:N,handleSizeChange:O}=x(z);const q=t(null);let B=t(!1);const D=t(null),L=()=>{B.value=!1};let $=e=>{P.getWeb3().then((e=>{e.eth.getAccounts().then((e=>{let l={fromPubAddress:e[0]};B.value=!0,_((()=>{D.value.showModal(l)}))}))}))};return(e,l)=>{const t=o("el-icon"),p=o("el-button"),h=o("el-option"),_=o("el-select"),P=o("el-form-item"),x=o("el-form"),H=o("el-table-column"),X=o("el-link"),G=o("el-table"),J=o("el-pagination");return n(),f("div",null,[s("div",S,[s("div",U,"Vcoin账户余额: "+b(d(j)),1),u(p,{type:"primary",onClick:d($)},{default:i((()=>[u(t,{style:{"vertical-align":"middle"}},{default:i((()=>[u(d(v))])),_:1}),I])),_:1},8,["onClick"]),u(x,{ref:"refsearchForm",inline:!0,class:"demo-searchForm ml-2"},{default:i((()=>[u(P,{"label-width":"0px",label:"",prop:"state","label-position":"left"},{default:i((()=>[u(_,{modelValue:d(m).state,"onUpdate:modelValue":l[0]||(l[0]=e=>d(m).state=e),class:"widthPx-150",placeholder:"支付单状态"},{default:i((()=>[(n(!0),f(A,null,y(d(w),(e=>(n(),r(h,{key:e.value,label:e.display,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},512),u(p,{type:"primary",onClick:V},{default:i((()=>[T])),_:1})]),s("div",W,[g("表格和分页"),u(G,{id:"detailElementDialog",ref_key:"mainTable",ref:q,height:"calc(100vh - 250px)",border:"",data:d(a)},{default:i((()=>[u(H,{align:"center",prop:"id",label:"ID",width:"80"}),u(H,{align:"center",prop:"amount",label:"充值Vcoin金额",width:"100"}),u(H,{align:"center",label:"支付单状态",width:"100"},{default:i((({row:e})=>[c(b(d(C)(e.state)),1)])),_:1}),u(H,{align:"center",prop:"payAmount",label:"支付金额（以太币）",width:"120"}),u(H,{align:"center",prop:"actualPayAmount",label:"实际支付金额（以太币）",width:"130"}),u(H,{align:"center",prop:"gasAmount",label:"手续费（以太币）",width:"130"}),u(H,{align:"center",prop:"payEthPubAddr",label:"付款Web3钱包账户","min-width":"200"},{default:i((({row:e})=>[u(X,{href:`https://goerli.etherscan.io/address/${e.payEthPubAddr}`,target:"_blank",type:"primary"},{default:i((()=>[c(b(e.payEthPubAddr),1)])),_:2},1032,["href"])])),_:1}),u(H,{align:"center",label:"交易ID","min-width":"220"},{default:i((({row:e})=>[u(X,{href:`https://goerli.etherscan.io/tx/${e.txId}`,target:"_blank",type:"primary"},{default:i((()=>[c(b(e.txId),1)])),_:2},1032,["href"])])),_:1}),u(H,{align:"center",prop:"createTime",label:"创建时间",width:"170"}),u(H,{align:"center",prop:"payTime",label:"支付时间",width:"170"})])),_:1},8,["height","data"]),g("分页"),s("div",F,[u(J,{"current-page":d(R),"page-sizes":[10,20,50,100],"page-size":d(M),layout:"total, sizes, prev, pager, next, jumper",total:d(k),onSizeChange:d(O),onCurrentChange:d(N)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),d(B)?(n(),r(E,{key:0,ref_key:"refRechargeForm",ref:D,onHideComp:L,onSelectPageReq:d(z)},null,8,["onSelectPageReq"])):g("v-if",!0)])])}}}),[["__scopeId","data-v-690ffb5a"],["__file","/Users/liuzhaoming/百度云同步盘/mac同步/project/valor/web3/mall/mall3-web/src/views/account/vcoin/Vcoin.vue"]]);export{N as default};
