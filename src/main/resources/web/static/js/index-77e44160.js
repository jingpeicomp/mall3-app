import{_ as e,e as t,f as a,g as l,m as n,i,j as o,c as s,k as r,b as d,t as p,l as u,L as y,v as m,G as c,r as b,M as f,h,N as g,O as v,s as w,x as T}from"./index-68f4f231.js";import{u as _,a as C}from"./useCommon-97a7458f.js";import{w as k}from"./web3Util-db437a6e.js";import{E as x}from"./index.es-8b9ca841.js";import{t as V}from"./useTablePage-337a13be.js";import"./web3.min-f7ec714c.js";const I=d("OpenSea"),M=d("查询拥有者"),z=d("购买"),F={class:"dialog-footer"},S=d("Cancel"),j=e({__name:"ViewItem",emits:["selectPageReq","hideComp"],setup(e,{expose:b,emit:f}){const{elMessage:h}=_();let g=e=>1===e?"已售出":"未售出",v=e=>1===e?"已充值":"未充值",w=t([]),T=t(null),x=t(null);const{dialogTitle:V,dialogVisible:j}=C();let N=()=>{f("hideComp")},P=e=>{let t=`https://testnets.opensea.io/zh-CN/assets/goerli/${x.value.contractAddress.toLowerCase()}/${e.id}`;window.open(t,"_blank")},U=e=>{let t={url:"/api/mall3/goods/nft/owner",method:"get",data:{goodsId:e.goodsId,itemId:e.id},isParams:!0,timeout:6e4,bfLoading:!0};m(t).then((e=>{c.alert(`${e.data}`,"NFT持有者",{confirmButtonText:"OK"})}))},O=e=>{k.getWeb3().then((t=>{let a=t;a.eth.getAccounts().then((t=>{let l=t[0];new a.eth.Contract(JSON.parse('[{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"itemIds","type":"uint256[]"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"string","name":"contractUrl","type":"string"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"indexed":false,"internalType":"uint256[]","name":"values","type":"uint256[]"}],"name":"TransferBatch","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"TransferSingle","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"value","type":"string"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"URI","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"accounts","type":"address[]"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"}],"name":"balanceOfBatch","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"buy","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"contractURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getItemOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getItems","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeBatchTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"}],"name":"setPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"to","type":"address"}],"name":"transfer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"uri","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}]'),x.value.contractAddress).methods.buy(e.id).send({from:l,value:a.utils.toWei(""+x.value.price,"ether")}).on("transactionHash",(function(t){let a={goodsId:x.value.id,count:1,itemId:e.id,txId:t};m({url:"/api/mall3/order",method:"post",data:a,timeout:2e4,bfLoading:!0}).then((e=>{h("提交订单成功")}))})).on("error",((e,t)=>{h("Web3购买商品失败: "+e,"error")}))}))}))};return b({showModal:e=>{V.value=`商品【${e.name||""}】附属卡`,j.value=!0,T.value=e.id,x.value=e,m({url:`/api/mall3/goods/${T.value}/item`,method:"get"}).then((e=>{w.value=e.data}))}}),(e,t)=>{const m=a("el-table-column"),c=a("el-button"),b=a("el-table"),f=a("el-dialog");return l(),n(f,{modelValue:r(j),"onUpdate:modelValue":t[0]||(t[0]=e=>y(j)?j.value=e:null),title:r(V),width:"70vw","close-on-click-modal":!1,"before-close":r(N)},{footer:i((()=>[o("span",F,[s(c,{onClick:r(N)},{default:i((()=>[S])),_:1},8,["onClick"])])])),default:i((()=>[s(b,{data:r(w),border:!1},{default:i((()=>[s(m,{label:"卡号",prop:"id","min-width":"200"}),1==r(x).saleChannel?(l(),n(m,{key:0,align:"center",label:"是否售出",width:"100"},{default:i((({row:e})=>[d(p(r(g)(e.sold)),1)])),_:1})):u("v-if",!0),s(m,{align:"center",label:"是否充值",width:"100"},{default:i((({row:e})=>[d(p(r(v)(e.recharged)),1)])),_:1}),2==r(x).saleChannel?(l(),n(m,{key:1,align:"center",label:"NFT操作","min-width":"120"},{default:i((({row:e})=>[s(c,{link:"",size:"small",type:"primary",onClick:t=>r(P)(e)},{default:i((()=>[I])),_:2},1032,["onClick"]),s(c,{link:"",size:"small",type:"primary",onClick:t=>r(U)(e)},{default:i((()=>[M])),_:2},1032,["onClick"]),s(c,{link:"",size:"small",type:"primary",onClick:t=>r(O)(e)},{default:i((()=>[z])),_:2},1032,["onClick"])])),_:1})):u("v-if",!0)])),_:1},8,["data"])])),_:1},8,["modelValue","title","before-close"])}}},[["__file","/Users/liuzhaoming/百度云同步盘/mac同步/project/valor/web3/mall/mall3-web/src/views/buyer/goods/ViewItem.vue"]]),N={class:"dialog-footer"},P=d("取消"),U=d("购买"),O=e({__name:"BuyForm",emits:["selectPageReq","hideComp"],setup(e,{expose:d,emit:p}){let u=b({goodsId:"",count:0});const c=t(null);let f=()=>{c.value.validate((e=>{if(!e)return!1;v()}))};const{formRules:h,elMessage:g}=_();let v=()=>m({url:"/api/mall3/order",data:u,method:"post",bfLoading:!0,timeout:2e4}).then((()=>{g("商品购买成功"),p("selectPageReq"),p("hideComp")}));const{dialogTitle:w,dialogVisible:T}=C();let k=()=>{p("hideComp")};return d({showModal:e=>{w.value=`购买商品【${e.name}】`,T.value=!0,u.goodsId=e.id}}),(e,t)=>{const d=a("el-input-number"),p=a("el-form-item"),m=a("el-form"),b=a("el-button"),g=a("el-dialog");return l(),n(g,{modelValue:r(T),"onUpdate:modelValue":t[1]||(t[1]=e=>y(T)?T.value=e:null),title:r(w),width:"30vw","close-on-click-modal":!1,"before-close":r(k)},{footer:i((()=>[o("span",N,[s(b,{onClick:r(k)},{default:i((()=>[P])),_:1},8,["onClick"]),s(b,{type:"primary",onClick:r(f)},{default:i((()=>[U])),_:1},8,["onClick"])])])),default:i((()=>[s(m,{ref_key:"refForm",ref:c,"label-width":"100px",inline:!1,model:r(u),rules:r(h),class:"pr-5"},{default:i((()=>[s(p,{label:"购买数量",prop:"count",rules:r(h).isNotNull,"label-position":"left"},{default:i((()=>[s(d,{modelValue:r(u).count,"onUpdate:modelValue":t[0]||(t[0]=e=>r(u).count=e),precision:0,step:1,max:10,min:1,"step-strictly":""},null,8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","before-close"])}}},[["__file","/Users/liuzhaoming/百度云同步盘/mac同步/project/valor/web3/mall/mall3-web/src/views/buyer/goods/BuyForm.vue"]]),A={class:"scroll-y"},$={class:"mr-3 rowSS"},R=d("查询"),B=d("附属卡"),W=d("OpenSea NFT"),q=d("购买"),L={class:"block columnCC mt-2"},H={name:"BuyGoods"},E=e(Object.assign(H,{setup(e){let y=t([]),c=b({periodType:"",deviceType:"",saleChannel:"",brand:"",showSeller:!1}),_=[{value:0,display:"所有"},{value:1,display:"月卡(30天)"},{value:2,display:"年卡(365天)"}],C=e=>1===e?"月卡(30天)":"年卡(365天)",k=[{value:0,display:"所有"},{value:1,display:"个人(单设备)"},{value:2,display:"家庭(4设备)"}],I=e=>1===e?"个人(单设备)":"家庭(4设备)",M=[{value:0,display:"所有"},{value:1,display:"Web2"},{value:2,display:"Web3"}],z=e=>1===e?"Web2":"Web3",F=e=>1===e?"Vcoin":"以太币";f((()=>{N()}));let S=t(1),N=()=>{const e=Object.assign(c,{pageNumber:P.value-1,pageSize:U.value}),t=JSON.parse(JSON.stringify(e));Object.keys(t).forEach((e=>{""!==t[e]&&null!==t[e]&&void 0!==t[e]&&0!==t[e]||delete t[e]})),m({url:"/api/mall3/goods",method:"get",data:t,isParams:!0}).then((e=>{var t,a;y.value=null==(t=e.data)?void 0:t.content,S.value=null==(a=e.data)?void 0:a.total}))},{pageNum:P,pageSize:U,handleCurrentChange:H,handleSizeChange:E}=V(N);const G=()=>{P.value=1,N()};let J=t(!1);const K=t(null),D=()=>{J.value=!1};let Q=e=>{J.value=!0,T((()=>{K.value.showModal(e)}))},X=e=>{let t;if(new RegExp("[\\u4E00-\\u9FFF]+","g").test(e.brand)){t=`https://testnets.opensea.io/zh-CN/collection/${x(e.brand,{type:"string",toneType:"none"}).replace(" ","-")}-${e.id}`}else t=`https://testnets.opensea.io/zh-CN/collection/${e.brand.toLowerCase()}-${e.id}`;window.open(t,"_blank")},Y=t(!1);const Z=t(null),ee=()=>{Y.value=!1};let te=e=>{Y.value=!0,T((()=>{Z.value.showModal(e)}))};return(e,t)=>{const m=a("el-input"),b=a("el-form-item"),f=a("el-option"),T=a("el-select"),x=a("el-form"),V=a("el-button"),ae=a("el-table-column"),le=a("el-image"),ne=a("el-link"),ie=a("el-table"),oe=a("el-pagination");return l(),h("div",A,[u("操作"),o("div",$,[u("条件搜索"),s(x,{ref:"refsearchForm",inline:!0,class:"demo-searchForm ml-2"},{default:i((()=>[s(b,{"label-width":"0px",label:"",prop:"type","label-position":"left"},{default:i((()=>[s(m,{modelValue:r(c).brand,"onUpdate:modelValue":t[0]||(t[0]=e=>r(c).brand=e),placeholder:"品牌"},null,8,["modelValue"])])),_:1}),s(b,{"label-width":"0px",label:"",prop:"type","label-position":"left"},{default:i((()=>[s(T,{modelValue:r(c).deviceType,"onUpdate:modelValue":t[1]||(t[1]=e=>r(c).deviceType=e),class:"widthPx-150",placeholder:"设备类型"},{default:i((()=>[(l(!0),h(g,null,v(r(k),(e=>(l(),n(f,{key:e.value,label:e.display,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(b,{"label-width":"0px",label:"",prop:"type","label-position":"left"},{default:i((()=>[s(T,{modelValue:r(c).periodType,"onUpdate:modelValue":t[2]||(t[2]=e=>r(c).periodType=e),class:"widthPx-150",placeholder:"周期类型"},{default:i((()=>[(l(!0),h(g,null,v(r(_),(e=>(l(),n(f,{key:e.value,label:e.display,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(b,{"label-width":"0px",label:"",prop:"type","label-position":"left"},{default:i((()=>[s(T,{modelValue:r(c).saleChannel,"onUpdate:modelValue":t[3]||(t[3]=e=>r(c).saleChannel=e),class:"widthPx-150",placeholder:"销售渠道"},{default:i((()=>[(l(!0),h(g,null,v(r(M),(e=>(l(),n(f,{key:e.value,label:e.display,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},512),u("查询按钮"),s(V,{type:"primary",onClick:G},{default:i((()=>[R])),_:1})]),u("表格和分页"),s(ie,{id:"mainTable",ref:"mainTable",height:`calc(100vh - ${r(w).delWindowHeight})`,border:"",data:r(y)},{default:i((()=>[s(ae,{align:"center",prop:"id",label:"Id",width:"80"}),s(ae,{align:"center",prop:"name",label:"商品名称","min-width":"140"}),s(ae,{align:"center",prop:"brand",label:"品牌",width:"100"}),s(ae,{align:"center",prop:"image",label:"商品图片","min-width":"120"},{default:i((({row:e})=>[s(le,{style:{width:"60px",height:"60px"},src:e.image},null,8,["src"])])),_:1}),s(ae,{align:"center",label:"设备类型",width:"100"},{default:i((({row:e})=>[d(p(r(I)(e.deviceType)),1)])),_:1}),s(ae,{align:"center",label:"周期类型",width:"100"},{default:i((({row:e})=>[d(p(r(C)(e.periodType)),1)])),_:1}),s(ae,{align:"center",label:"销售渠道",width:"100"},{default:i((({row:e})=>[d(p(r(z)(e.saleChannel)),1)])),_:1}),s(ae,{align:"center",label:"货币类型",width:"100"},{default:i((({row:e})=>[d(p(r(F)(e.currencyType)),1)])),_:1}),s(ae,{align:"center",prop:"price",label:"价格",width:"100"}),s(ae,{align:"center",prop:"count",label:"上架库存",width:"100"}),s(ae,{align:"center",prop:"contractAddress",label:"智能合约地址","min-width":"160"},{default:i((({row:e})=>[s(ne,{href:`https://goerli.etherscan.io/address/${e.contractAddress}`,target:"_blank",type:"primary"},{default:i((()=>[d(p(e.contractAddress),1)])),_:2},1032,["href"])])),_:1}),u("点击操作"),s(ae,{fixed:"right",align:"center",label:"操作","min-width":"105"},{default:i((({row:e})=>[s(V,{link:"",size:"small",type:"primary",onClick:t=>r(Q)(e)},{default:i((()=>[B])),_:2},1032,["onClick"]),2==e.saleChannel?(l(),n(V,{key:0,link:"",size:"small",type:"primary",onClick:t=>r(X)(e)},{default:i((()=>[W])),_:2},1032,["onClick"])):u("v-if",!0),1==e.saleChannel?(l(),n(V,{key:1,link:"",size:"small",type:"primary",onClick:t=>r(te)(e)},{default:i((()=>[q])),_:2},1032,["onClick"])):u("v-if",!0)])),_:1})])),_:1},8,["height","data"]),u("分页"),o("div",L,[s(oe,{"current-page":r(P),"page-sizes":[10,20,50,100],"page-size":r(U),layout:"total, sizes, prev, pager, next, jumper",total:r(S),onSizeChange:r(E),onCurrentChange:r(H)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),r(J)?(l(),n(j,{key:0,ref_key:"refItemViewForm",ref:K,onHideComp:D,onSelectPageReq:r(N)},null,8,["onSelectPageReq"])):u("v-if",!0),r(Y)?(l(),n(O,{key:1,ref_key:"refBuyForm",ref:Z,onHideComp:ee,onSelectPageReq:r(N)},null,8,["onSelectPageReq"])):u("v-if",!0)])}}}),[["__scopeId","data-v-f12c555c"],["__file","/Users/liuzhaoming/百度云同步盘/mac同步/project/valor/web3/mall/mall3-web/src/views/buyer/goods/BuyerGoods.vue"]]);export{E as default};
